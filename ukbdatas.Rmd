---
title: "datatables"
author: "Bagi Laura"
date: "2023-10-16"
output: html_document
---

```{r}

#Librarys
library(ggplot2)
library(ggpubr)
library(match2C)
library(dplyr)
library(plyr)
year_of_birth = read.table("", header = T) #34
month_of_birth= read.table("", header = T) #52
sex = read.table("", header = T) #31
date_of_attendings = read.table("", header = T) #53
ethnic = read.table("", header = T) #21000
date_of_cancer_diag = read.table("", header = T) #40005
type_of_cancer = read.table("", header = T) #40006
age_of_cancer_diag=read.table("", header = T) #40008

#UKB Datas all in 1
ukb_datas_all_in_1=data.frame( eid=numeric(502366))
ukb_datas_all_in_1$eid = year_of_birth$eid
df_births = data.frame(eid=year_of_birth$eid, year=year_of_birth$value, 
                       month= month_of_birth$value[match(month_of_birth$eid, year_of_birth$eid)], 
                       day= 15)
df_births$birthdate = paste(df_births$year,
                  df_births$month,
                  df_births$day,
                  sep = "-")
ukb_datas_all_in_1$birthdate= df_births$birthdate[match(df_births$eid, ukb_datas_all_in_1$eid)]
ukb_datas_all_in_1$sex = sex$value[match(sex$eid, ukb_datas_all_in_1$eid)]
dataframe_ethnic = data.frame(eid=unique(ethnic$eid),
                              ethnic=I(split(ethnic$value, ethnic$eid))
                              )
ukb_datas_all_in_1$ethnic = dataframe_ethnic$ethnic[match(ukb_datas_all_in_1$eid, dataframe_ethnic$eid)]
df_date_of_a = data.frame(eid= unique(date_of_attendings$eid),
                          value= I(split(date_of_attendings$value, date_of_attendings$eid))
                          )
ukb_datas_all_in_1$attendings= df_date_of_a$value[match(ukb_datas_all_in_1$eid, df_date_of_a$eid)]
ukb_datas_all_in_1$cancerdiag = date_of_cancer_diag$value[match(ukb_datas_all_in_1$eid, date_of_cancer_diag$eid, nomatch = NA)]
ukb_datas_all_in_1$Cancer.Diag.Age= age_of_cancer_diag$value[match(ukb_datas_all_in_1$eid, age_of_cancer_diag$eid, nomatch = NA)]
df_cancer_type = data.frame(eid=unique(type_of_cancer$eid),
                            cancer= I(split(type_of_cancer$value, type_of_cancer$eid))
                            )
ukb_datas_all_in_1$cancertypes = df_cancer_type$cancer[match(ukb_datas_all_in_1$eid, df_cancer_type$eid, nomatch = NA)]

#Date of cancer diag. + cancer type
date_of_cancer_diag
type_of_cancer

cancerdiag_list = list(eid=unique(date_of_cancer_diag$eid),
                       value=I(split(date_of_cancer_diag$value, date_of_cancer_diag$UKB_column_name)))
cancer_type_list = list(eid=unique(type_of_cancer$eid),
                        value=I(split(type_of_cancer$UKB_column_name, type_of_cancer$value)))

cancerdiag_list_2 = list(diag= I(split(date_of_cancer_diag$UKB_column_name, date_of_cancer_diag$eid)))
cancer_type_list_2 = list(ctype = I(split(type_of_cancer$UKB_column_name, type_of_cancer$eid)))

cancerdiag_df = data.frame(eid=unique(date_of_cancer_diag$eid),
                          data=I(split(date_of_cancer_diag$UKB_column_name,date_of_cancer_diag$eid)))
cancertype_df = data.frame(eid=unique(type_of_cancer$eid),
                           data=I(split(type_of_cancer$UKB_column_name, type_of_cancer$eid)))

#lapply: mini dataframe: 1.c:eid, 2.c:dates, 3.c:cc, egyénenként menjen végig ->utána rbind egy nagy tábla

cancer_datas=lapply(X = unique(date_of_cancer_diag$eid), FUN = function(x) {
  temp_df=date_of_cancer_diag[date_of_cancer_diag$eid==x,]
  temp_df$cnid= substr(x = temp_df$UKB_column_name, start = 7, stop = 10)
  tempdf_2=type_of_cancer[type_of_cancer$eid==x,]
  tempdf_2$cnid= substr(x = tempdf_2$UKB_column_name, start = 7, stop = 10)
  cancer_df=left_join(x = temp_df, y = tempdf_2, by = "cnid")
  cancer_df=cancer_df[,c(1,4,3,7)]
  colnames(cancer_df)= c("eid", "cnid", "diagdate", "ctype")
  cancer_df
})
cancer_datas=do.call(rbind,cancer_datas)


```

